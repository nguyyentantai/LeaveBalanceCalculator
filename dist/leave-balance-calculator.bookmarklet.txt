javascript:(()=>{const totalLeaveDays=20,hoursPerDay=8,totalLeaveHours=160,monthlyLeaveHours=13.333333333333334,membershipPath=["api_calls","CURRENT_MEMBERSHIP","data"];let dateOfService=0,extraLeaveHours=0;const parseServiceDate=e=>!e||!/\d{2}\/\d{2}\/\d{4}/.test(e)?null:new Date(e.split("/").reverse().join("-")),getExtraLeaveHours=(e,o)=>{if(!e||!/\d{2}\/\d{2}\/\d{4}/.test(e))return console.log("Invalid year of service, set to 0"),0;const r=parseServiceDate(e);if(!r)return console.log("Invalid year of service, set to 0"),0;const s=o-r.getFullYear(),n=s>=0?s:0;return extraLeaveHours=n>=0?Math.floor(n/5)*8:0,extraLeaveHours},getBaseLeaveHours=(e,o)=>{const r=parseServiceDate(e);if(!r)return 160;const s=r.getFullYear();if(o<s)return 0;if(o>s)return 160;let n=12-r.getMonth();return r.getDate()>15&&(n-=1),n=Math.max(Math.min(n,12),0),Math.round(monthlyLeaveHours*n*100)/100},isCarryOverPossible=e=>{const o=new Date(e);if(Number.isNaN(o.getTime()))return!1;const r=o.getUTCFullYear(),s=o.getUTCMonth(),n=o.getUTCDate();return r>=2024&&(s<2||s===2&&n<=31)},formatDaysAndHours=e=>{if(!Number.isFinite(e))return"0 days";const o=Math.round(e*100)/100,r=o<0,s=Math.abs(o),n=Math.floor(s/8),l=Math.round(s%8*100)/100,i=l>0?`${n} days ${l} hours`:`${n} days`;return r?`-${i}`:i},calculateLeaveSummary=(e,o)=>{const r={},s={},n={},l={},i={},g={},v={},p={};e.forEach(t=>{const c=new Date(t.start_date.split("/").reverse().join("-")).getFullYear();if(r[c]===void 0&&(r[c]=0,s[c]=!1,n[c]=0,l[c]=0),t.leave_category_name==="Annual Leave (VN)"||t.leave_category_name==="Annual Leave"){r[c]+=t.total_units,t.leave_hours.forEach(u=>{if(isCarryOverPossible(u.date)){const d=parseFloat(u.hours);l[c]+=Number.isFinite(d)?d:0}});return}(t.leave_category_name==="Leisure Rules Day"||t.leave_category_name==="Leisure Rules Day (VN)")&&(s[c]=!0)});const a={},L=Object.keys(r).map(t=>parseInt(t,10)).sort((t,c)=>t-c);return L.forEach(t=>{const c=t-1,u=c>=2024&&n[c]||0,d=getBaseLeaveHours(o,t);i[t]=d;const y=getExtraLeaveHours(o,t);g[t]=y;const h=l[t]||0,f=Math.min(u,h);v[t]=f;const b=Math.max(u-f,0);p[t]=b;const H=r[t]-f,D=d+y-H;a[t]=D,n[t]=t>=2024&&D>0?D:0}),L.map(t=>{const c=r[t],u=s[t],d=t-1>=2024&&n[t-1]||0,y=v[t]||0,h=p[t]||0,f=g[t]||0,b=i[t]||0,O=a[t],H=t>=2024?Math.max(n[t]||0,0):0;return{year:t,baseLeaveHours:b,extraLeaveHours:f,leisureDayBooked:u,bookedHours:c,availableHours:O,carryOverFromPrevious:d,carryOverUsedBeforeExpiry:y,carryOverExpired:h,carryOverToNext:H}})},findStoreInFiber=e=>{var o;return e?(o=e.memoizedProps)!=null&&o.store?e.memoizedProps.store:findStoreInFiber(e.child)||findStoreInFiber(e.sibling):null},getReduxStoreFromHook=()=>{var r;if(typeof window=="undefined")return null;const e=window.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e)return null;const o=e.renderers||e._renderers;if(!o)return null;for(const[s]of o.entries()){const n=typeof e.getFiberRoots=="function"&&e.getFiberRoots(s)||((r=e._fiberRoots)==null?void 0:r.get(s));if(n)for(const l of n){const i=findStoreInFiber(l==null?void 0:l.current);if(i)return i}}return null},formatIsoToServiceDate=e=>{if(!e)return null;const o=new Date(e);if(Number.isNaN(o.getTime()))return null;const r=String(o.getDate()).padStart(2,"0"),s=String(o.getMonth()+1).padStart(2,"0"),n=o.getFullYear();return`${r}/${s}/${n}`},detectDateOfServiceFromStore=()=>{const e=getReduxStoreFromHook();if(!e||typeof e.getState!="function")return null;let o=e.getState();for(const r of membershipPath)if(o&&Object.prototype.hasOwnProperty.call(o,r))o=o[r];else{o=null;break}return o!=null&&o.created_at?formatIsoToServiceDate(o.created_at):null},ensureDateOfService=()=>{if(dateOfService)return dateOfService;const e=detectDateOfServiceFromStore();return e?(dateOfService=e,console.log(`Detected start date of service from CURRENT_MEMBERSHIP: ${dateOfService}`),dateOfService):(typeof prompt=="function"?(dateOfService=prompt("Enter the start date of service (dd/mm/yyyy):"),console.log(`Date of service: ${dateOfService}`)):(console.warn("Unable to detect service date automatically and prompt is unavailable."),dateOfService=""),dateOfService)},initLeaveBalanceCalculator=e=>{if(!e||typeof e.fetch!="function")return;const o=e.fetch;return e.fetch=(...r)=>{const s=o.apply(e,r);return s.then(async n=>{const l=n.url;if(l&&/\/api\/v3\/organisations\/\d+\/members\/\d+\/leave_requests/.test(l)){const v=await n.clone().json();calculateLeaveSummary(v.data.items,dateOfService).forEach(a=>{console.log(`Year ${a.year}:`),console.log(`- Annual Leave Entitlement: ${formatDaysAndHours(a.baseLeaveHours)}`),console.log(`- Extra Leave Hours: ${a.extraLeaveHours} hour(s)`),console.log(`- Booked Leisure day: ${a.leisureDayBooked}`),console.log(`- Booked Annual leaves: ${formatDaysAndHours(a.bookedHours)}`),console.log(`- Available Annual leaves: ${formatDaysAndHours(a.availableHours)}`),a.carryOverFromPrevious>0&&(console.log(`- Carry Over from ${a.year-1} (expires 31/03/${a.year}): ${formatDaysAndHours(a.carryOverFromPrevious)}`),console.log(`- Carry Over Used before 31/03/${a.year}: ${formatDaysAndHours(a.carryOverUsedBeforeExpiry)}`),console.log(`- Carry Over Expiring on 31/03/${a.year}: ${formatDaysAndHours(a.carryOverExpired)}`)),a.year>=2024&&console.log(`- Carry Over to ${Number(a.year)+1}: ${formatDaysAndHours(a.carryOverToNext)}`)})}}),s},ensureDateOfService(),"Please change the item per page to see the results, better to set it to 100.Thank you!"};typeof window!="undefined"&&initLeaveBalanceCalculator(window),typeof module!="undefined"&&module.exports&&(module.exports={parseServiceDate,getExtraLeaveHours,getBaseLeaveHours,isCarryOverPossible,formatDaysAndHours,calculateLeaveSummary,initLeaveBalanceCalculator});
})();