javascript:(()=>{const totalLeaveDays=20,hoursPerDay=8,totalLeaveHours=160,monthlyLeaveHours=13.333333333333334;let dateOfService=0,extraLeaveHours=0;const parseServiceDate=o=>!o||!/\d{2}\/\d{2}\/\d{4}/.test(o)?null:new Date(o.split("/").reverse().join("-")),getExtraLeaveHours=(o,a)=>{if(!o||!/\d{2}\/\d{2}\/\d{4}/.test(o))return console.log("Invalid year of service, set to 0"),0;const s=parseServiceDate(o);if(!s)return console.log("Invalid year of service, set to 0"),0;const n=a-s.getFullYear(),t=n>=0?n:0;return extraLeaveHours=t>=0?Math.floor(t/5)*8:0,extraLeaveHours},getBaseLeaveHours=(o,a)=>{const s=parseServiceDate(o);if(!s)return 160;const n=s.getFullYear();if(a<n)return 0;if(a>n)return 160;let t=12-s.getMonth();return s.getDate()>15&&(t-=1),t=Math.max(Math.min(t,12),0),Math.round(monthlyLeaveHours*t*100)/100},isCarryOverPossible=o=>{const a=new Date(o);return a<new Date(a.getFullYear(),2,31)&&a.getFullYear()>=2024},formatDaysAndHours=o=>{if(!Number.isFinite(o))return"0 days";const a=Math.round(o*100)/100,s=a<0,n=Math.abs(a),t=Math.floor(n/8),l=Math.round(n%8*100)/100,v=l>0?`${t} days ${l} hours`:`${t} days`;return s?`-${v}`:v},calculateLeaveSummary=(o,a)=>{const s={},n={},t={},l={},v={},g={},f={},p={};o.forEach(e=>{const c=new Date(e.start_date.split("/").reverse().join("-")).getFullYear();if(s[c]||(s[c]=0,n[c]=!1,t[c]=0,l[c]=0),e.leave_category_name==="Annual Leave (VN)"||e.leave_category_name==="Annual Leave"){s[c]+=e.total_units,e.leave_hours.forEach(i=>{if(isCarryOverPossible(i.date)){const u=parseFloat(i.hours);l[c]+=Number.isFinite(u)?u:0}});return}(e.leave_category_name==="Leisure Rules Day"||e.leave_category_name==="Leisure Rules Day (VN)")&&(n[c]=!0)});const r={},x=Object.keys(s).map(e=>parseInt(e,10)).sort((e,c)=>e-c);return x.forEach(e=>{const c=e-1,i=c>=2024&&t[c]||0,u=getBaseLeaveHours(a,e);v[e]=u;const y=getExtraLeaveHours(a,e);g[e]=y;const h=l[e]||0,d=Math.min(i,h);f[e]=d;const H=Math.max(i-d,0);p[e]=H;const L=s[e]-d,b=u+y-L;r[e]=b,t[e]=e>=2024&&b>0?b:0}),x.map(e=>{const c=s[e],i=n[e],u=e-1>=2024&&t[e-1]||0,y=f[e]||0,h=p[e]||0,d=g[e]||0,H=v[e]||0,D=r[e],L=e>=2024?Math.max(t[e]||0,0):0;return{year:e,baseLeaveHours:H,extraLeaveHours:d,leisureDayBooked:i,bookedHours:c,availableHours:D,carryOverFromPrevious:u,carryOverUsedBeforeExpiry:y,carryOverExpired:h,carryOverToNext:L}})},initLeaveBalanceCalculator=o=>{if(!o||typeof o.fetch!="function")return;const a=o.fetch;return o.fetch=(...s)=>{const n=a.apply(o,s);return n.then(async t=>{const l=t.url;if(l&&/\/api\/v3\/organisations\/\d+\/members\/\d+\/leave_requests/.test(l)){const f=await t.clone().json();calculateLeaveSummary(f.data.items,dateOfService).forEach(r=>{console.log(`Year ${r.year}:`),console.log(`- Annual Leave Entitlement: ${formatDaysAndHours(r.baseLeaveHours)}`),console.log(`- Extra Leave Hours: ${r.extraLeaveHours} hour(s)`),console.log(`- Booked Leisure day: ${r.leisureDayBooked}`),console.log(`- Booked Annual leaves: ${formatDaysAndHours(r.bookedHours)}`),console.log(`- Available Annual leaves: ${formatDaysAndHours(r.availableHours)}`),r.carryOverFromPrevious>0&&(console.log(`- Carry Over from ${r.year-1} (expires 31/03/${r.year}): ${formatDaysAndHours(r.carryOverFromPrevious)}`),console.log(`- Carry Over Used before 31/03/${r.year}: ${formatDaysAndHours(r.carryOverUsedBeforeExpiry)}`),console.log(`- Carry Over Expiring on 31/03/${r.year}: ${formatDaysAndHours(r.carryOverExpired)}`)),r.year>=2024&&console.log(`- Carry Over to ${Number(r.year)+1}: ${formatDaysAndHours(r.carryOverToNext)}`)})}}),n},typeof prompt=="function"?(dateOfService=prompt("Enter the start date of service (dd/mm/yyyy):"),console.log(`Date of service: ${dateOfService}`)):dateOfService="","Please change the item per page to see the results, better to set it to 100.Thank you!"};typeof window!="undefined"&&initLeaveBalanceCalculator(window),typeof module!="undefined"&&module.exports&&(module.exports={parseServiceDate,getExtraLeaveHours,getBaseLeaveHours,isCarryOverPossible,formatDaysAndHours,calculateLeaveSummary,initLeaveBalanceCalculator});
})();